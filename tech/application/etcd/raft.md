# Raft 알고리즘

## Raft 알고리즘 ( 뗏목 합의 알고리즘 )

* 리더&#x20;
* 팔로워
* 후보자 : 리더가 없는 상황에서 새 리더를 정하기 전 팔로워의 상태를 의미



### 리더선출

가정 :

1. 리더는 임기(Term)을 갖고 대표직을 한다.
2. 모든 팔로워는 후보자가 되는 기간을 Election Timeout 150\~300ms 의 기간을 가진다.
3. 리더는 모든 팔로워에게 반복적으로 HeartBeat을 전달한다. 이는 리더 상태를 유지하는 수단이다.

리더 선출 과정 :&#x20;

1. 리더가 없는 상태 ) 모든 팔로워가 Election Timeout을 가진다.
2. Election Timeout이 가장 먼저 끝난 노드가 후보자가 된다. 후보자 노드는 즉시 자신에게 한표를 주고 팔로워들에게 투표를 요청한다.
3. 팔로워가 해당 임기 중에 투표한적이 없다면, 후보자에게 투표 메시지를 보낸다. 자신의 Election Timeout을 초기화 한다.
4. 후보자가 전체 노드의 과반 (N+1)/2 응답을 받으면 리더로 선정된다.
5. 리더는 주기적으로 팔로워에게 HeartBeat을 전송한다.
6. 팔로워는 HearBeat을 받을 때마다 Election Timeout을 초기화한다. ( 팔로워 상태를 유지한다. )



&#x20;:interrobang: 재선거 상황

* 4개 노드에서 우연히 2개의 후보자가 동시에 나타나서,  각각 2표를 얻는 경우
  * 누구도 과반을 얻지 못한다.
  * 재선거를 시작한다.



Quorum (정족수)

* 3개 노드에서 한개 장애 발생으로 2개 노드가 된 경우, 과반 (2+1)/2 와 같거나 큰 자연수, 2가 된다.
* 2개 중 하나가 문제가 발생한다면, 리더 선출 및 클러스터 기능이 붕괴된다.
* 따라서, 정족수가 충족되어야 한다.
